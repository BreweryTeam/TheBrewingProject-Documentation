---
import config from "virtual:starlight/user-config";

import Search from "@astrojs/starlight/components/Search.astro";
import SidebarPersister from "@astrojs/starlight/components/SidebarPersister.astro";
import SidebarSublist from "@astrojs/starlight/components/SidebarSublist.astro";
import { Image } from "astro:assets";
import { Icon } from "@astrojs/starlight/components";
import ThemeSelect from "@astrojs/starlight/components/ThemeSelect.astro";

import logo from "@/assets/img/favicon.png";

const { sidebar } = Astro.locals.starlightRoute;
const shouldRenderSearch = config.pagefind || config.components.Search !== "@astrojs/starlight/components/Search.astro";
const socials = config.social || [];
---

<div class="sidebar-wrapper">
    <div class="sidebar-header">
        <a href="/" class="logo-link">
            <Image src={logo} alt={"TheBrewingProject"} width={26} height={26} />
            <span class="site-title">TheBrewingProject</span>
        </a>

        {shouldRenderSearch && <Search />}
    </div>

    <div class="sidebar-scrollable-content">
        <SidebarPersister>
            <SidebarSublist sublist={sidebar} />
        </SidebarPersister>
    </div>

    <div class="sidebar-footer">
        <div class="social-links">
            {
                socials.length > 0 && (
                    <>
                        {socials.map(({ label, href, icon }) => (
                            <a {href} rel="me" class="social-link">
                                <span class="sr-only">{label}</span>
                                <Icon class="social-icon" name={icon} />
                            </a>
                        ))}
                    </>
                )
            }
        </div>
        <ThemeSelect />
    </div>
</div>

<style>
    .sidebar-wrapper {
        display: flex;
        height: 100%;
        flex-direction: column;
        gap: 0.5rem;
    }

    .sidebar-header {
        display: flex;
        flex-shrink: 0;
        flex-direction: column;
        gap: 0.75rem;
        padding-top: 0.75rem;
        padding-bottom: 0.5rem;
    }

    .logo-link {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 0.5rem;
        text-decoration: none;
    }

    .site-title {
        color: var(--sl-color-white);
        font-weight: 600;
    }

    .sidebar-scrollable-content {
        flex-grow: 1;
        overflow-y: auto;
    }

    .sidebar-footer {
        display: flex;
        flex-shrink: 0;
        align-items: center;
        justify-content: space-between;
        border-top: 1px solid var(--sl-color-gray-5);
        padding-top: 0.25rem;
        padding-bottom: 0.25rem;
    }

    .social-links {
        display: flex;
        gap: 0.5rem;
        padding-left: 0.25rem;
        font-size: 1.25rem;
    }

    .social-link {
        display: flex;
        align-items: center;
    }

    .social-icon {
        color: var(--sl-color-gray-2);
    }

    .sidebar-header,
    .sidebar-scrollable-content,
    .sidebar-footer {
        padding-left: calc(var(--sl-sidebar-pad-x) * 0.8);
        padding-right: calc(var(--sl-sidebar-pad-x) * 0.8);
    }
</style>
